---
import Layout from "../../layouts/Layout.astro";
---

<Layout title=`How Many of Us Are There - Renting`>
  <main class="w-screen text-xl">
    <section
      class="flex flex-col lg:flex-row gap-10 p-10 text-black justify-center items-center"
    >
      <!-- Left/Top side -->
      <div class="flex flex-col gap-5 items-center justify-center text-center">
        <h2 class="text-6xl font-bold block">
          I want my Member of Parliament to know that people who rent have a lot
          of votes
        </h2>
        <form action="/my-handling-form-page" method="post">
          <input
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"
            id="postcodeInput"
            type="text"
            placeholder="Postcode"
          />
        </form>
        <button
          class="bg-dark-blue hover:bg-white text-white hover:text-dark-blue hover:border-dark-blue border underline font-bold py-2 px-4 focus:outline-none focus:shadow-outline max-w-80 w-full"
          type="button"
          id="postcodeBtn"
        >
          HOW MANY ARE WITH ME
        </button>
      </div>

      <!--  -->
      <div class="flex flex-col gap-5 items-center lg:items-start">
        <img src="/../../../public/artwork.png" alt="" />
      </div>
    </section>
  </main>
  <script>
    import { navigate } from "astro:transitions/client";

    document.addEventListener("DOMContentLoaded", function () {
      const postcodeBtnEl = document.getElementById("postcodeBtn");
      const postcodeInputEl = document.getElementById("postcodeInput");

      postcodeBtnEl.addEventListener("click", (event) => {
        event.preventDefault();
        const postcode = postcodeInputEl.value;
        retrieveCID(postcode);
      });
    });

    //FTP API fetch
    function retrieveCID(postcode) {
      const queryURL =
        "https://findthatpostcode.uk//postcodes/" + postcode + ".json";
      fetch(queryURL)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          const pconValue = data.data.attributes.pcon_name.replace(/\s/g, "-");
          navigate("./" + pconValue);
        });
    }
  </script>
</Layout>
